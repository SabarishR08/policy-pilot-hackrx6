<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Policy Pilot</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  </head>
  <body>
    <div class="background"></div>
    <main class="shell">
      <header class="hero">
        <p class="eyebrow">Offline Policy Intelligence</p>
        <h1>Policy Pilot</h1>
        <p class="lede">
          Upload policy PDFs, build a local index, and query answers with clause-level
          citations. Everything runs on your machine.
        </p>
      </header>

      <section class="panel">
        <div class="panel-header">
          <h2>1. Upload PDFs</h2>
          <p>Add new policy documents to the data folder.</p>
        </div>
        <form class="stack" method="post" action="/upload" enctype="multipart/form-data">
          <input class="file" type="file" name="pdf" accept="application/pdf" />
          <button class="primary" type="submit">Upload PDF</button>
        </form>
      </section>

      <section class="panel">
        <div class="panel-header">
          <h2>2. Build Index</h2>
          <p>Create embeddings and store them in FAISS.</p>
        </div>
        <form class="grid" method="post" action="/build">
          <label>
            Chunk size
            <input type="number" name="chunk_size" value="1000" />
          </label>
          <label>
            Overlap
            <input type="number" name="overlap" value="150" />
          </label>
          <label class="toggle">
            <input type="checkbox" name="use_cleaned" />
            Use cleaned_data if available
          </label>
          <button class="primary" type="submit">Rebuild Index</button>
        </form>
      </section>

      <section class="panel">
        <div class="panel-header">
          <h2>3. Ask a Question</h2>
          <p>Get a structured JSON answer with clause citations.</p>
        </div>
        <form class="stack" method="post" action="/query">
          <label>
            Query
            <textarea name="query" rows="3" placeholder="Is knee surgery covered?"></textarea>
          </label>
          <div class="grid">
            <label>
              Top K
              <input type="number" name="top_k" value="3" />
            </label>
            <label>
              Max tokens
              <input type="number" name="max_tokens" value="256" />
            </label>
            <label>
              Temperature
              <input type="number" step="0.1" name="temperature" value="0.2" />
            </label>
            <label>
              LLM context
              <input type="number" name="n_ctx" value="2048" />
            </label>
            <label>
              Threads
              <input type="number" name="n_threads" value="4" />
            </label>
            <label>
              Model path
              <input type="text" name="model_path" value="models/tinyllama-1.1b-chat-v1.0.Q4_K_M.gguf" />
            </label>
            <label class="toggle">
              <input type="checkbox" name="use_cleaned" />
              Use cleaned_data if available
            </label>
          </div>
          <button class="primary" type="submit">Run Query</button>
        </form>
      </section>

      {% if status %}
      <section class="panel status">
        <p>{{ status }}</p>
      </section>
      {% endif %}

      {% if error %}
      <section class="panel status error">
        <p>{{ error }}</p>
      </section>
      {% endif %}

      {% if answer %}
      <section class="panel result">
        <div class="panel-header">
          <h2>JSON Response</h2>
          <p>Copy the structured output into your workflow.</p>
        </div>
        <pre>{{ answer }}</pre>
      </section>
      {% endif %}
    </main>
  </body>
</html>
